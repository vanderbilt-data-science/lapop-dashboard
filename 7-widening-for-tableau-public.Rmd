---
title: "Widening for Tableau Public"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---



# Structure

Now that we finally have a single dataframe with all the countries with only the common questions, we need to widen it so that it fits within Tableau Public's limit.

In order to do this we are going to:

* combine columns into the format of "category:question text"
* select the necessary columns (country, wave, person_id, weight, category_question, answer_measure)
* pivot using names from `category_question` and values from `answer_measure`

## Combining category and question
```{r}
total_long_common <- total_long_common %>% 
  unite(category_question, category, question, sep = ":") %>%
  select(country, wave, person_id = person_id_factor, weights, category_question, answer_measure) 
```

Clear out all but needed dataframes to reduce memory

```{r}
rm.all.but(c("total_long_common", "countries_common_only"))
```


## Pivoting Wider 
Also, this is where my memory fails
```{r}
final_wide <- total_long_common %>% 
#  head(10000000) %>% # Get first 100K questions to reduce memory %>%
  pivot_wider(id_cols = c(person_id, country, wave), 
              names_from = category_question,
              values_from = answer_measure)

write_csv(final_wide, "lapop_wide.csv")
```


